<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<link rel="shortcut icon" type="image/png" href="themes/favicon.png">
<title>Gerrit Configuration &amp; Code Review Best Practices</title>
<link rel="stylesheet" href="themes/css/html-zenika.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Gerrit Configuration &amp; Code Review Best Practices</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#user-documentation">1. User documentation</a></li>
<li><a href="#server-installation">2. Server installation</a></li>
<li><a href="#server-configuration">3. Server configuration</a>
<ul class="sectlevel2">
<li><a href="#initialization">3.1. Initialization</a>
<ul class="sectlevel3">
<li><a href="#permissions">3.1.1. Permissions</a>
<ul class="sectlevel4">
<li><a href="#jenkins-user-push">Jenkins user push</a></li>
<li><a href="#deleting-tags">Deleting tags</a></li>
<li><a href="#gitweb-access">Allow (gitweb) access for everyone</a></li>
</ul>
</li>
<li><a href="#verified-status">3.1.2. Verified status</a></li>
<li><a href="#fast-forward">3.1.3. Fast Forward</a></li>
</ul>
</li>
<li><a href="#user-preferences">3.2. User preferences</a></li>
<li><a href="#project-creation">3.3. Project creation</a>
<ul class="sectlevel3">
<li><a href="#old-ui">3.3.1. Old UI</a></li>
<li><a href="#polygerrit">3.3.2. PolyGerrit</a></li>
<li><a href="#project-url">3.3.3. Project git address/URL</a></li>
<li><a href="#users-groups-creation">3.3.4. Users groups creation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#code-review-golden-rules-using-gerrit">4. Code review golden rules (using Gerrit)</a></li>
<li><a href="#troobleshootings">5. Troobleshootings</a>
<ul class="sectlevel2">
<li><a href="#submit-replaced-with-submit-including-parents">5.1. Submit replaced with Submit including parents</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><span class="icon"><a class="image" href="index.html"><i class="fa fa-home"></i></a></span> ‏ ‏ ‎
<span class="icon"><a class="image" href="BP-gerrit.adoc"><i class="fa fa-file-text-o"></i></a></span> ‏ ‏ ‎
<span class="icon"><a class="image" href="BP-gerrit.pdf"><i class="fa fa-file-pdf-o"></i></a></span></p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./images/dilbert-collaboration.png" alt="dilbert collaboration" width="50%">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="user-documentation"><a class="anchor" href="#user-documentation"></a>1. User documentation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Official user documentation is <a href="https://gerrit-review.googlesource.com/Documentation/intro-user.html">here</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="server-installation"><a class="anchor" href="#server-installation"></a>2. Server installation</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="title">Using docker</div>
<div class="content">
<pre>docker run -p 8080:8080 -p 29418:29418 gerritcodereview/gerrit</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Updated with new UI
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Connect to Gerrit homepage</p>
<div class="ulist">
<ul>
<li>
<p>First person to connect is the administrator</p>
</li>
<li>
<p>Without LDAP, other users are added at first connection</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>So, as the administrator :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Skip the plugin configuration</p>
</li>
<li>
<p>Click on the image in the top right corner &#8594; <b class="button">Settings</b>, and set</p>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>Full name</p>
</li>
<li>
<p>Changes per page = 100 rows</p>
</li>
<li>
<p>Date/time format</p>
</li>
<li>
<p><i class="fa fa-check-square-o"></i> Set new changes to "work in progress"</p>
<div class="ulist">
<ul>
<li>
<p>Click <b class="button">Save changes</b></p>
</li>
</ul>
</div>
</li>
<li>
<p>Ignore Whitespace = All</p>
<div class="ulist">
<ul>
<li>
<p>Click <b class="button">Save changes</b></p>
</li>
</ul>
</div>
</li>
<li>
<p>New email address = <a href="mailto:your@mail.com">your@mail.com</a></p>
<div class="ulist">
<ul>
<li>
<p>reload page</p>
</li>
<li>
<p>select your mail in list</p>
</li>
<li>
<p>delete <a href="mailto:email@example.com">email@example.com</a></p>
</li>
<li>
<p>Click <b class="button">Save changes</b></p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <b class="button">Generate New Password</b></p>
<div class="ulist">
<ul>
<li>
<p>save it for later</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="server-configuration"><a class="anchor" href="#server-configuration"></a>3. Server configuration</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In further sections, actions are for old UI
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="initialization"><a class="anchor" href="#initialization"></a>3.1. Initialization</h3>
<div class="sect3">
<h4 id="permissions"><a class="anchor" href="#permissions"></a>3.1.1. Permissions</h4>
<div class="sect4">
<h5 id="jenkins-user-push"><a class="anchor" href="#jenkins-user-push"></a>Jenkins user push</h5>
<div class="ulist">
<ul>
<li>
<p>Click on <strong>People</strong> &#8594; <strong>List Groups</strong> &#8594; <strong>Non-interactive Users</strong></p>
</li>
<li>
<p>Add Jenkins (your technical account) in the list</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="deleting-tags"><a class="anchor" href="#deleting-tags"></a>Deleting tags</h5>
<div class="ulist">
<ul>
<li>
<p>Click on <strong>Projects</strong> &#8594; <strong>List</strong> &#8594; <b class="button">All-projects</b> &#8594; section <strong>Access</strong> &#8594; <strong>Edit</strong></p>
</li>
<li>
<p>Under <b class="button">Reference: refs/tags/*</b></p>
<div class="ulist">
<ul>
<li>
<p>Click on <b class="button">Add Permission&#8230;&#8203;</b> and select <strong>Push</strong></p>
</li>
<li>
<p>Select group <strong>Administrator</strong> and click <strong>Force Push</strong></p>
</li>
<li>
<p>Save Changes</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Now you can delete tags from your projects, for ex :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">  git push --force --delete origin cg-wm-1.17.6</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="gitweb-access"><a class="anchor" href="#gitweb-access"></a>Allow (gitweb) access for everyone</h5>
<div class="ulist">
<ul>
<li>
<p>Click on <strong>Projects</strong> &#8594; <strong>List</strong> &#8594; <b class="button">All-projects</b> &#8594; section <strong>Access</strong> &#8594; <strong>Edit</strong></p>
</li>
<li>
<p>Under <strong>Reference: refs/meta/config</strong></p>
<div class="ulist">
<ul>
<li>
<p>Under <strong>Read</strong></p>
<div class="ulist">
<ul>
<li>
<p>Click on <b class="button">Add Group</b></p>
</li>
<li>
<p>Enter <strong>Registered Users</strong></p>
</li>
<li>
<p>Click <b class="button">Add</b></p>
</li>
<li>
<p>Save Changes</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./images/geek-and-poke-only-idiot.jpg" alt="geek and poke only idiot" width="50%">
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="verified-status"><a class="anchor" href="#verified-status"></a>3.1.2. Verified status</h4>
<div class="ulist">
<ul>
<li>
<p>Click on <strong>Projects</strong> &#8594; <strong>List</strong> &#8594; <b class="button">All-Projects</b> &#8594; section <strong>General</strong> &#8594; <strong>Edit Config</strong></p>
</li>
<li>
<p>Add this</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ini hljs" data-lang="ini"> [label "Verified"]
    function = MaxWithBlock
    value = -1 Fails
    value =  0 No score
    value = +1 Verified</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click on <strong>Save</strong>, then <strong>Close</strong></p>
</li>
<li>
<p>Click on <strong>Publish Edit</strong>, then <strong>Publish</strong>, <b class="button">Code-Review+2</b>, <strong>Submit</strong></p>
</li>
<li>
<p>Click on <strong>Projects</strong> &#8594; <strong>List</strong> &#8594; <b class="button">All-Projects</b> &#8594; <strong>Access</strong> &#8594; <strong>Edit</strong></p>
</li>
<li>
<p>Under <b class="button">Reference:	refs/heads/*</b></p>
<div class="ulist">
<ul>
<li>
<p>Click on <b class="button">Add Permission&#8230;&#8203;</b> and select <strong>Label Verified</strong></p>
</li>
<li>
<p>Select group <strong>Administrator</strong></p>
</li>
<li>
<p>Select group <b class="button">Non-Interactive Users</b></p>
</li>
<li>
<p>Save Changes</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="fast-forward"><a class="anchor" href="#fast-forward"></a>3.1.3. Fast Forward</h4>
<div class="paragraph">
<p>By default, when projet submissions are not fast forward, final submitting a change will create a merge commit. The history is potentially doubled.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Click on <strong>Projects</strong> &#8594; <strong>List</strong> &#8594; <b class="button">All-Projects</b> &#8594; <strong>General</strong></p>
</li>
<li>
<p>Under <strong>Submit Type</strong>, select <strong>Rebase if Necessary</strong></p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./images/devrant-git-blame.jpg" alt="devrant git blame" width="50%">
</div>
<div class="title">Figure 1. Life without code review</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="user-preferences"><a class="anchor" href="#user-preferences"></a>3.2. User preferences</h3>
<div class="paragraph">
<p>Click on  <strong>YourName</strong> &#8594; <strong>Settings</strong> &#8594; <strong>Diff Preferences</strong> and set <strong>columns = 120</strong>
(you will probably have to paste it due to a GUI bug)</p>
</div>
</div>
<div class="sect2">
<h3 id="project-creation"><a class="anchor" href="#project-creation"></a>3.3. Project creation</h3>
<div class="sect3">
<h4 id="old-ui"><a class="anchor" href="#old-ui"></a>3.3.1. Old UI</h4>
<div class="paragraph">
<p>Create your GIT project by clicking on <strong>Projects</strong> &#8594; <strong>Create New Project</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Project Name = <strong>your-project-name</strong></p>
</li>
<li>
<p>Rights Inherit From = <strong>All-Projects</strong></p>
</li>
<li>
<p>Check that it has inherited correctly "Rebase if necessary", else change and save</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="polygerrit"><a class="anchor" href="#polygerrit"></a>3.3.2. PolyGerrit</h4>
<div class="paragraph">
<p>Create your GIT project by clicking on <strong>Browse</strong> &#8594; <strong>Repositories &#8594; *Create New</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Repository Name = <strong>your-project-name</strong></p>
</li>
<li>
<p>Rights Inherit From = <strong>All-Projects</strong></p>
</li>
<li>
<p>Owner = Technical responsible</p>
</li>
<li>
<p>Click <b class="button">Create</b></p>
</li>
<li>
<p>Check that it has inherited correctly "Rebase if necessary", else change and click <b class="button">SAVE CHANGES</b></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="project-url"><a class="anchor" href="#project-url"></a>3.3.3. Project git address/URL</h4>
<div class="paragraph">
<p>To get the repo address of your project under Gerrit :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Navigate to <b class="button">Projects</b> &#8594; <b class="button">List</b></p>
</li>
<li>
<p>in front of <b class="button">your-project</b>, click on (gitweb)</p>
</li>
<li>
<p>Take the .git text next to <strong>URL</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example : <a href="https://my-url.com/gerrit/my-project.git" class="bare">https://my-url.com/gerrit/my-project.git</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you don&#8217;t have access to Gitweb interface ("Not Found"), ask your admin to do <a href="#gitweb-access">Allow (gitweb) access for everyone</a>.
</td>
</tr>
</table>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./images/geek-and-poke-dont-update.jpg" alt="geek and poke dont update" width="33%">
</div>
</div>
</div>
<div class="sect3">
<h4 id="users-groups-creation"><a class="anchor" href="#users-groups-creation"></a>3.3.4. Users groups creation</h4>
<div class="paragraph">
<p>For each project, create a reviewer list and a validator list.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Go to <strong>Projects</strong> &#8594; <strong>Create New Group</strong></p>
</li>
<li>
<p>Reviewers list</p>
<div class="ulist">
<ul>
<li>
<p>Give a name, for example <b class="button">dge-reviewers</b></p>
</li>
<li>
<p>Add every developers / primary reviewers on the project</p>
</li>
<li>
<p>Click on <strong>General</strong></p>
</li>
<li>
<p>Description = Reviewers (first level : +1)</p>
</li>
<li>
<p>Click <strong>Save Description</strong></p>
</li>
<li>
<p>Check <b class="button">Make group visible to all registered users.</b></p>
</li>
<li>
<p>Click <strong>Save Group Options</strong></p>
</li>
</ul>
</div>
</li>
<li>
<p>Validators list</p>
<div class="ulist">
<ul>
<li>
<p>Give a name for example <b class="button">dge-validators</b></p>
</li>
<li>
<p>Add technical responsible and a backup</p>
</li>
<li>
<p>Click on <strong>General</strong></p>
</li>
<li>
<p>Description = "Validators (level 2 : +2)"</p>
</li>
<li>
<p>Click <strong>Save Description</strong></p>
</li>
<li>
<p>check <b class="button">Make group visible to all registered users.</b></p>
</li>
<li>
<p>Click <strong>Save Group Options</strong></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./images/turnoff-what-your-code-looks-like.png" alt="turnoff what your code looks like" width="33%">
</div>
<div class="title">Figure 2. Repository without code review</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="code-review-golden-rules-using-gerrit"><a class="anchor" href="#code-review-golden-rules-using-gerrit"></a>4. Code review golden rules (using Gerrit)</h2>
<div class="sectionbody">
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./images/gerrit-process.png" alt="gerrit process" width="100%">
</div>
</div>
<div class="olist arabic">
<div class="title">These are rules to be followed for a smooth overall development process :</div>
<ol class="arabic">
<li>
<p>The team has to know that you are taking responsability of the current development task.</p>
</li>
<li>
<p>If not sure of what to achieve, confirm with task responsible</p>
</li>
<li>
<p>Target a complete realization in delays estimated by team leader. Alert on time shortage.</p>
</li>
<li>
<p>Update documentation along with code whenever it&#8217;s needed.</p>
</li>
<li>
<p>Do not group functionnalities in commit, to avoid long run reviews.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>It is possible to handle multiple review in parallel.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Commit text has to be explicit, complete, and synthetic.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Commit text must be one line for the sake of history and documentation readability (replace ':' with '()' and '-' with '+'). No limit to the lengh of the line.</p>
</li>
<li>
<p>If the commit include documentation, set a first line commit text suitable for documentation. Put other information on other lines (they won&#8217;t appear in documentation history)</p>
</li>
</ol>
</div>
</li>
<li>
<p>Commit often, at least on tuesdays and thursdays (even on unfinished current task).</p>
</li>
<li>
<p>No "related changes" should appear on the change in Gerrit, or you did not handle multiple review properly.</p>
</li>
<li>
<p>Fixing Jenkins failures is always a top priority.</p>
</li>
<li>
<p>On "Cannot merge" Gerrit message, you have to pull/commit/push to rebase properly</p>
</li>
<li>
<p>When Jenkins give a +1, add the <strong>reviewers</strong> list as reviewers, this should add all reviewing people.</p>
</li>
<li>
<p>When added as a reviewer, try to give a review in the next half day, knowing that it blocks the process.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>You don&#8217;t have to be an expert to do a review. At least try to spot pieces of code not well explained and missing javadoc. Try to imagine yourself as a future bug fixer who needs clean code to work properly.</p>
</li>
<li>
<p>If suitable, test the application or check the auto IT tests.</p>
</li>
<li>
<p>If any, check that the generated documention looks good in PDF.</p>
</li>
<li>
<p>Check that there is UT specifically testing the new/modified code.</p>
</li>
</ol>
</div>
</li>
<li>
<p>When one or two +1 from the team have been given (depending on the size of the team), add the <strong>validators</strong> list of reviewers for a final +2 review followed by a submit to the master branch.</p>
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./images/git-messages.png" alt="git messages" width="33%">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="troobleshootings"><a class="anchor" href="#troobleshootings"></a>5. Troobleshootings</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="submit-replaced-with-submit-including-parents"><a class="anchor" href="#submit-replaced-with-submit-including-parents"></a>5.1. Submit replaced with Submit including parents</h3>
<div class="paragraph">
<p>If the <b class="button">Submit</b> button is replaced with <b class="button">Submit including parents</b>, there is obviously a problem in the git tree. You have to rebase. You can ask the developer to do so in his IDE and push again. But you can also do it in the UI :</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>Click <b class="button">Rebase</b>, select</p>
</li>
<li>
<p><i class="fa fa-check-square-o"></i> Change parent revision</p>
</li>
<li>
<p>leave the field blank</p>
</li>
<li>
<p>Click <b class="button">Rebase</b></p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./images/turnoff-refactoring.png" alt="turnoff refactoring" width="33%">
</div>
<div class="title">Figure 3. Peer review is better for ego than peer refactoring</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-12-11 21:17:56 UTC
</div>
</div>
<link rel="stylesheet" href="highlight/styles/gruvbox-dark.min.css">
<script src="highlight/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>