= Gitlab Configuration Details
include::subdocs/_init.adoc[]

ifndef::imagesdir[:imagesdir: images]

== Introduction

Gitlab in his link:https://about.gitlab.com/pricing/#gitlab-com[free online plan] offers some nice features :

* 2,000 CI pipeline minutes per group per month on our shared runners
* Unlimited private projects and collaborators
** Built-in CI/CD
** Cycle Analytics
** Issue Boards
** Time tracking
** Preview your changes with Review Apps
** Publish static websites for free with GitLab Pages
** Git LFS 2.0 support

== Server configuration

WARNING: TODO

== Project creation

* Create a project in web interface.
** check *Create README.md* or else *master* branch is not created
* Import git project in Eclipse
* Change git config, adding :

  [user]
    name = yourname
    email = youraccount@yourprovider.com

=== rebase without merge commit

* In the web interface, go to *Project* -> *Settings* -> *General* -> *Merge request*, and configure as follow :
** [x] Fast-forward merge
** [x] Only allow merge requests to be merged if the pipeline succeeds 
** [ ] Only allow merge requests to be merged if all discussions are resolved
 
=== Protect master branch

Gitlab workflow is not as straightforward as Gerrit's (see below). In Eclipse, it's too easy to push to master instead of our current Merge Request's branch.

Here is how to protect it :
 
* In Gitlab interface, navigate to your project -> *Settings* -> *Repository* -> expend *Protected Branches* and configure :
** Branch = *master*
** Allowed to merge = *Maintainers*
** Allowed to push = *No one*
 
=== Merge Requests workflow

We assume that we will be the only one to push on that branch, so we do not check-out the branch, and just push there. This helps do fewer interactions in Eclipse.

.Initialize the change
* Go to *Issues* -> *New issue*
* Set information and create
* Click *Create merge request*
* In Eclipse, right click on your repo -> *Pull*
** The branch should appear under *Branches* -> *Remote Tracking*
* Update the files...
* Commit
* Right click on local/master -> Push Branch...
** Toggle
*** [ ] Configure Pull
*** [ ] Force
**  Next -> Finish

.On each new dev iteration
** Commit with amend, ignore the warning
** Right click on local/master -> Push Branch...
** Toggle
*** [ ] Configure Pull
*** [x] Force
** Next -> Finish

.Merge in Gitlab
* Browse the Merge Request in Gitlab
* [x] Remove source branch
* Remove the Remote branch in your git repo -> Branches -> Remote Tracking
* Right click on your repo -> *Pull*
** If you get an error, you have obviously configure Pull for the dead branch, so use *Pull...* instead and select *master* branch


=== Pipeline creation

//[source, yaml] does not seem to work with highlight.js :(
[source,bash]
.Pipeline content
----
include::../../../.gitlab-ci.yml[]
----

include::subdocs/_closure.adoc[]
